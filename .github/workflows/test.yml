name: Test Coverage
on: [push]
jobs:
  test_coverage:
    name: Test Coverage
    runs-on: ubuntu-latest
    env:
      SHA_SHORT: ${{ github.sha }}
    steps:
      - uses: actions/checkout@v2
      
      - run: echo "<h1>Foobar</h1>" > tarpaulin-report.html
      # - name: Install Rust toolchain
      #   uses: actions-rs/toolchain@v1
      #   with:
      #     profile: minimal
      #     toolchain: stable
      #     override: true

      # - name: Run tarpaulin
      #   uses: actions-rs/tarpaulin@v0.1
      #   with:
      #     out-type: Html

      - run: |
          branch=$(git branch --show-current)
          time=$(TZ=UTC git show --quiet --date='format-local:%Y%m%dT%H%M%SZ' --format="%cd")
          sha=${GITHUB_SHA:0:8}
          slug=$(echo ${branch}_${time}_${sha} | sed -r 's/[^[:alnum:]_-]/-/g')
          echo "slug=$slug" >> $GITHUB_ENV
        shell: bash

      - run: mv tarpaulin-report.html test_coverage_${{ env.slug }}.html

      - name: Upload coverage report
        uses: actions/upload-artifact@v2
        with:
          name: test_coverage_${{ env.slug }}
          path: test_coverage_${{ env.slug }}.html